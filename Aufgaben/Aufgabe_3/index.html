<!DOCTYPE html>
<html>
<head>
    <title>Real-Time Rendering SS12</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="../../style/master.css" media="all" charset="utf-8">
    <script src="../../script/jquery-1.7.2.js" type="text/javascript"></script>
    
    <script src="script/gl-matrix.js" type="text/javascript"></script>
    <script src="script/tdl/base.js" type="text/javascript"></script>
    <script src="script/tdl/webgl.js" type="text/javascript"></script>
    <script src="script/tdl/models.js" type="text/javascript"></script>
    <script src="script/tdl/primitives.js" type="text/javascript"></script>
    <script src="script/tdl/programs.js" type="text/javascript"></script>
</head>
<body>
    <header></header>
    <nav><ul></ul></nav>
    <hr>
    <section id="content">
        <h2>Aufgabe 3</h2>
        <canvas id ="canvas" style="border: none;"></canvas>
        <select id="shaderSelect"></select>
    </section>
    <hr>
    <footer></footer>
    <!-- script src="../../script/cms.js" type="text/javascript"></script-->
    <!-- SHADER -->
    <script id="vs0" type="text/glsl" name="Einfarbig">
        uniform mat4 projection;
        uniform mat4 view;
        uniform mat4 model;

        //from tdl.primitiv return
        attribute vec4 position;

        void main() {
        gl_Position = projection * view * model * position;
        }
    </script>

    <script id="fs0" type="text/glsl" name="Einfarbig">
        precision highp float;

        uniform vec3 color;

        void main() {
        gl_FragColor.rgb = 0.7 * color;
        gl_FragColor.a = 1.0;
        }
    </script>

    <script id="vs1" type="text/glsl" name="Phong">
        uniform mat4 projection;
        uniform mat4 view;
        uniform mat4 model;

        uniform vec3 lightPosition;
        uniform vec3 camera;

        attribute vec4 position;
        attribute vec3 normal;

        varying vec3 normalW;
        varying vec3 lightDirectionW;
        varying vec3 cameraDirectionW;

        void main() {
            vec4 positionW = model * position;
            normalW = (model * vec4(normal, 0.0)).xyz;
            lightDirectionW = lightPosition - positionW.xyz;
            cameraDirectionW = camera - positionW.xyz;

            gl_Position = projection * view * positionW;
        }
    </script>

    <script id="fs1" type="text/glsl">
        precision highp float;

        uniform vec3 color;
        uniform vec3 lightColor;

        varying vec3 normalW;
        varying vec3 lightDirectionW;
        varying vec3 cameraDirectionW;

        vec3 lambert(vec3 normal, vec3 light, vec3 intensity, vec3 reflectivity) {
            return 0.1 * reflectivity * intensity +
            0.6 * reflectivity * intensity * max(0.0, dot(normal, light));
        }

        vec3 phong(vec3 normal, vec3 eye, vec3 light, vec3 intensity, vec3 reflectivity) {
            return lambert(normal, light, intensity, reflectivity) +
            0.3 * intensity * pow(max(0.0, dot(reflect(-eye, normal),
            light)), 10.0);
        }

        void main() {
        gl_FragColor.rgb = phong(
            normalize(normalW),
            normalize(cameraDirectionW),
            normalize(lightDirectionW),
            lightColor, color);
            gl_FragColor.a = 1.0;
        }
    </script>
    <script id="vs2" type="text/glsl" name="Toon">
        uniform mat4 projection;
        uniform mat4 view;
        uniform mat4 model;

        uniform vec3 lightPosition;
        uniform vec3 camera;



        attribute vec4 position;
        attribute vec3 normal;

        varying vec3 normalW;
        varying vec3 lightDirectionW;
        varying vec3 cameraDirectionW;
        varying float toonSteps;


        void main() {
        toonSteps = 3.0;
        vec4 positionW = model * position;
        normalW = (model * vec4(normal, 0.0)).xyz;
        lightDirectionW = lightPosition - positionW.xyz;
        cameraDirectionW = camera - positionW.xyz;

        gl_Position = projection * view * positionW;
        }
    </script>

    <script id="fs2" type="text/glsl">
        precision highp float;

        uniform vec3 color;
        uniform vec3 lightColor;
        varying float toonSteps;

        varying vec3 normalW;
        varying vec3 lightDirectionW;
        varying vec3 cameraDirectionW;






        vec3 toon(vec3 that){
            return vec3( ceil(that.x * toonSteps) / toonSteps ,
                         ceil(that.y * toonSteps) / toonSteps ,
                         ceil(that.z * toonSteps) / toonSteps );
        }

        float toon(float that){
            return toon(vec3(that, 0.0, 0.0)).x;
        }

        vec3 lambert(vec3 normal, vec3 light, vec3 intensity, vec3 reflectivity) {
            return 0.1 * reflectivity * intensity +
                   0.6 * reflectivity * intensity * toon(max(0.0, dot(normal, light)));
        }

        vec3 phong(vec3 normal, vec3 eye, vec3 light, vec3 intensity, vec3 reflectivity) {
            return  lambert(normal, light, intensity, reflectivity)
                    /*+
                    0.3 * intensity * pow(max(0.0, dot(reflect(-eye, normal),
                    light)), 10.0)
                    */;

        }



        void main() {
            gl_FragColor.rgb = phong(
            normalize(normalW),
            normalize(cameraDirectionW),
            normalize(lightDirectionW),
            lightColor,
            color);
            gl_FragColor.a = 1.0;
        }
    </script>
    <script src="../../script/cms.js" type="text/javascript"></script>
    <script src="script/aufgabe3.js" type="text/javascript"></script>
</body>
</html>